# 告警


```mermaid
flowchart LR
  A[开始] --> B{条件?}
  B -- 是 --> C[执行方案1]
  B -- 否 --> D[执行方案2]
  C --> E[结束]
  D --> E
```


持续监测数据库实例的运行状况对于确保企业运营的连续性和稳定性极为关键。MOC 为用户提供了实例管理平台的告警功能，使得用户能够迅速识别并预警可能的风险和问题，从而采取及时的应对策略。这一功能不仅增强了系统的可靠性，确保了业务的无缝运行，还提升了数据库管理的效率，是企业确保数据安全、优化运维流程的关键工具。

## 告警规则

告警功能专注于实例管理平台的监控，目前不涉及数据库管理平台的业务层面监控，它主要覆盖账户、实例计费和实例状态的非人为操作引起的变化。

### 查看告警规则

您可以登录实例管理平台，依次点击**告警** > **告警规则**来查看告警规则。

<div align="center">
    <img src=https://community-shared-data-1308875761.cos.ap-beijing.myqcloud.com/artwork/mocdocs/alarm/alarm-04.png width=80% heigth=80%/>
</div>

在告警规则的界面上，用户可以浏览包括告警表达式、告警类别、告警级别在内的详细信息。系统将自动开启部分关键告警规则，您可以根据需要对告警启用状态进行调整。此外，您还可以对规则进行修改，或者选择删除不需要的告警规则。

如果您想查看触发告警的详细信息，可点击告警规则最右侧的日志图标跳转至**告警记录**查看。

### 创建告警规则

除了系统预设的告警规则，用户还可以根据需要创建个性化的告警规则。要进行这一操作，请先登录到实例管理平台，然后依次点击**告警** > **告警规则** > **创建告警**，即可进入设置自定义告警规则的页面。

<div align="center">
    <img src=https://community-shared-data-1308875761.cos.ap-beijing.myqcloud.com/artwork/mocdocs/alarm/alarm-01.png width=60% heigth=60%/>
</div>

- 告警类别：分为账户计费、实例计费、实例状态

- 告警表达式：是由一系列监控指标、比较关系、阈值、统计周期和持续周期组成的逻辑表达式，用以定义何时触发告警。它有以下限制：
    - 实例管理平台的告警表达式是固定的，不支持用户自定义，但可以对告警的阈值进行调整以满足特定的监控需求。
    - 用户可以基于同一规则创建多个具有不同阈值的告警表达式，但对于具有相同规则和阈值的告警表达式允许创建一个。
    - 每种表达式都设有默认的告警级别和通知周期。
    - 根据各自的特性，每种告警表达式都设定了不同的默认阈值以及可输入或选择的阈值区间。
    - 每个组织允许设定的告警规则数量上限为 100 条。

- 告警级别
    - 提示：问题属于轻微级别，不影响资源的正常运作，系统默认通过邮件的方式进行通知。
    - 重要：问题相对严重，对业务产生了一定影响，系统将默认通过邮件和短信的方式进行通知。
    - 紧急：遇到紧急故障或业务功能中断，系统将自动通过邮件、短信和电话多种方式进行紧急通知。

- 通知周期：指当一条告警的表达式被持续触发后，系统向用户发送通知的最小时间差。它有以下规则：
    - 一旦告警得到处理（即在随后的检测周期中未再触发告警），系统将立刻重新开始计算新的告警周期。
    - 调整告警阈值后，系统将立即更新通知的时间间隔。
    - 调整告警周期后，系统将立即按照新设定的时间间隔重新计算下一次告警与上一次告警之间的时间。如果当前时间已经超过了设定值，系统将立即触发告警。
    - 如果不同实体触发多次告警，每个实体的告警通知和时间间隔将独立进行计算。

- 通知方式：一旦告警被触发，系统将通过多种方式向用户发出通知，用户可以选择零种或多种通知方式，包括邮件、短信和电话。每种方式都可以独立指定接收者。用户无需手动输入接收者的详细信息，只需从通讯录中选择相应的名称即可。若未选择任何通知方式，告警信息将仅记录在告警日志中。在创建告警规则时，一旦选定了通知途径，则必须指定相应的通知对象。不同的通知方式有着不同的限制：
    - 电话：每日通知上限为 20 次，对于同一个号码，通知频率为每分钟不超过 1 次，每小时不超过 5 次，以及每日不超过 20 次。有时可能会因为电话号码遭到恶意举报并被相应的服务提供商屏蔽，导致尽管告警规则已被触发并通过电话方式发出通知，用户却未收到电话告警。
    - 邮箱：无上限。
    - 短信：每日发送通知上限为 100 次。

- 启用状态：告警默认启用，可以指定一个启动时间或者永久禁用。

## 通讯录

### 查看通讯录

为了方便用户管理不同通知方式的通知对象信息，我们将几种通知方式的对象信息以告警通讯录的形式集合在一起，以名称作为每个接收者的唯一标识符，默认的第一个通知对象是组织主账号。你可登录至实例平台，依次点击**告警** > **通讯录**来查看通讯录列表，列表显示名称、邮箱、电话等信息。

<div align="center">
    <img src=https://community-shared-data-1308875761.cos.ap-beijing.myqcloud.com/artwork/mocdocs/alarm/alarm-05.png width=80% heigth=80%/>
</div>

### 添加联系人

在通讯录处您可以添加联系人，依次点击**告警** > **通讯录** > **新建联系人**，输入您的联系人信息：

<div align="center">
    <img src=https://community-shared-data-1308875761.cos.ap-beijing.myqcloud.com/artwork/mocdocs/alarm/alarm-02.png width=40% heigth=40%/>
</div>

成功添加联系人后，您可以修改除 id 之外的所有属性，修改完成后，告警管理的关联同步更新。对于不需要的联系人，您也可以进行删除操作或者关闭**启用状态**按钮来禁用联系人。请留意：告警通讯录中的联系人数量不能超过 1000 个。

## 告警记录

告警日志用于追踪和存档告警规则触发的历史。用户可以在告警日志界面查询最近一个月内的告警记录，并通过告警规则 ID、告警表达式以及起始和结束日期等条件来过滤和查找特定的告警条目。

<div align="center">
    <img src=https://community-shared-data-1308875761.cos.ap-beijing.myqcloud.com/artwork/mocdocs/alarm/alarm-03.png width=80% heigth=80%/>
</div>
